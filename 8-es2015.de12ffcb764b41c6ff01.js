(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{jtF9:function(e,t,i){"use strict";i.r(t),i.d(t,"QrModule",(function(){return f}));var r=i("ofXK"),s=i("tyNb"),n=i("HDdC"),a=i("LRne");class o{static hasCamera(){return navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(e=>e.some(e=>"videoinput"===e.kind)).catch(()=>!1):Promise.resolve(!1)}constructor(e,t,i=this._onDecodeError.bind(this),r=o.DEFAULT_CANVAS_SIZE,s="environment"){this.$video=e,this.$canvas=document.createElement("canvas"),this._onDecode=t,this._preferredFacingMode=s,this._active=!1,this._paused=!1,this._flashOn=!1,"number"==typeof i?(r=i,console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in the future")):this._onDecodeError=i,this.$canvas.width=r,this.$canvas.height=r,this._sourceRect={x:0,y:0,width:r,height:r},this._updateSourceRect=this._updateSourceRect.bind(this),this._onPlay=this._onPlay.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this.$video.playsInline=!0,this.$video.muted=!0,this.$video.disablePictureInPicture=!0,this.$video.addEventListener("loadedmetadata",this._updateSourceRect),this.$video.addEventListener("play",this._onPlay),document.addEventListener("visibilitychange",this._onVisibilityChange),this._qrEnginePromise=o.createQrEngine()}hasFlash(){if(!("ImageCapture"in window))return Promise.resolve(!1);const e=this.$video.srcObject?this.$video.srcObject.getVideoTracks()[0]:null;return e?new ImageCapture(e).getPhotoCapabilities().then(e=>e.fillLightMode.includes("flash")).catch(e=>(console.warn(e),!1)):Promise.reject("Camera not started or not available")}isFlashOn(){return this._flashOn}toggleFlash(){return this._setFlash(!this._flashOn)}turnFlashOff(){return this._setFlash(!1)}turnFlashOn(){return this._setFlash(!0)}destroy(){this.$video.removeEventListener("loadedmetadata",this._updateSourceRect),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),this.stop(),o._postWorkerMessage(this._qrEnginePromise,"close")}start(){if(this._active&&!this._paused)return Promise.resolve();if("https:"!==window.location.protocol&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,this._paused=!1,document.hidden)return Promise.resolve();if(clearTimeout(this._offTimeout),this._offTimeout=null,this.$video.srcObject)return this.$video.play(),Promise.resolve();let e=this._preferredFacingMode;return this._getCameraStream(e,!0).catch(()=>(e="environment"===e?"user":"environment",this._getCameraStream())).then(t=>{e=this._getFacingMode(t)||e,this.$video.srcObject=t,this.$video.play(),this._setVideoMirror(e)}).catch(e=>{throw this._active=!1,e})}stop(){this.pause(),this._active=!1}pause(){this._paused=!0,this._active&&(this.$video.pause(),this._offTimeout||(this._offTimeout=setTimeout(()=>{const e=this.$video.srcObject?this.$video.srcObject.getTracks():[];for(const t of e)t.stop();this.$video.srcObject=null,this._offTimeout=null},300)))}static scanImage(e,t=null,i=null,r=null,s=!1,n=!1){const a=i instanceof Worker;let c=Promise.all([i||o.createQrEngine(),o._loadImage(e)]).then(([e,n])=>{let c;return i=e,[r,c]=this._drawToCanvas(n,t,r,s),i instanceof Worker?(a||i.postMessage({type:"inversionMode",data:"both"}),new Promise((e,t)=>{let s,n,a;n=r=>{"qrResult"===r.data.type&&(i.removeEventListener("message",n),i.removeEventListener("error",a),clearTimeout(s),null!==r.data.data?e(r.data.data):t(o.NO_QR_CODE_FOUND))},a=e=>{i.removeEventListener("message",n),i.removeEventListener("error",a),clearTimeout(s),t("Scanner error: "+(e?e.message||e:"Unknown Error"))},i.addEventListener("message",n),i.addEventListener("error",a),s=setTimeout(()=>a("timeout"),1e4);const h=c.getImageData(0,0,r.width,r.height);i.postMessage({type:"decode",data:h},[h.data.buffer])})):new Promise((e,t)=>{const s=setTimeout(()=>t("Scanner error: timeout"),1e4);i.detect(r).then(i=>{i.length?e(i[0].rawValue):t(o.NO_QR_CODE_FOUND)}).catch(e=>t("Scanner error: "+(e.message||e))).finally(()=>clearTimeout(s))})});return t&&n&&(c=c.catch(()=>o.scanImage(e,null,i,r,s))),c=c.finally(()=>{a||o._postWorkerMessage(i,"close")}),c}setGrayscaleWeights(e,t,i,r=!0){o._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:i,useIntegerApproximation:r})}setInversionMode(e){o._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static createQrEngine(e=o.WORKER_PATH){return("BarcodeDetector"in window?BarcodeDetector.getSupportedFormats():Promise.resolve([])).then(t=>-1!==t.indexOf("qr_code")?new BarcodeDetector({formats:["qr_code"]}):new Worker(e))}_onPlay(){this._updateSourceRect(),this._scanFrame()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_updateSourceRect(){const e=Math.min(this.$video.videoWidth,this.$video.videoHeight),t=Math.round(2/3*e);this._sourceRect.width=this._sourceRect.height=t,this._sourceRect.x=(this.$video.videoWidth-t)/2,this._sourceRect.y=(this.$video.videoHeight-t)/2}_scanFrame(){if(!this._active||this.$video.paused||this.$video.ended)return!1;requestAnimationFrame(()=>{this.$video.readyState<=1?this._scanFrame():this._qrEnginePromise.then(e=>o.scanImage(this.$video,this._sourceRect,e,this.$canvas,!0)).then(this._onDecode,e=>{this._active&&(-1!==(e.message||e).indexOf("service unavailable")&&(this._qrEnginePromise=o.createQrEngine()),this._onDecodeError(e))}).then(()=>this._scanFrame())})}_onDecodeError(e){e!==o.NO_QR_CODE_FOUND&&console.log(e)}_getCameraStream(e,t=!1){const i=[{width:{min:1024}},{width:{min:768}},{}];return e&&(t&&(e={exact:e}),i.forEach(t=>t.facingMode=e)),this._getMatchingCameraStream(i)}_getMatchingCameraStream(e){return navigator.mediaDevices&&0!==e.length?navigator.mediaDevices.getUserMedia({video:e.shift()}).catch(()=>this._getMatchingCameraStream(e)):Promise.reject("Camera not found.")}_setFlash(e){return this.hasFlash().then(t=>t?this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:e}]}):Promise.reject("No flash available")).then(()=>this._flashOn=e)}_setVideoMirror(e){this.$video.style.transform="scaleX("+("user"===e?-1:1)+")"}_getFacingMode(e){const t=e.getVideoTracks()[0];return t?/rear|back|environment/i.test(t.label)?"environment":/front|user|face/i.test(t.label)?"user":null:null}static _drawToCanvas(e,t=null,i=null,r=!1){i=i||document.createElement("canvas");const s=t&&t.x?t.x:0,n=t&&t.y?t.y:0,a=t&&t.width?t.width:e.width||e.videoWidth,o=t&&t.height?t.height:e.height||e.videoHeight;r||i.width===a&&i.height===o||(i.width=a,i.height=o);const c=i.getContext("2d",{alpha:!1});return c.imageSmoothingEnabled=!1,c.drawImage(e,s,n,a,o,0,0,i.width,i.height),[i,c]}static _loadImage(e){if(e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||window.ImageBitmap&&e instanceof window.ImageBitmap||window.OffscreenCanvas&&e instanceof window.OffscreenCanvas)return Promise.resolve(e);if(e instanceof Image)return o._awaitImageLoad(e).then(()=>e);if(e instanceof File||e instanceof Blob||e instanceof URL||"string"==typeof e){const t=new Image;return t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e,o._awaitImageLoad(t).then(()=>((e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src),t))}return Promise.reject("Unsupported image type.")}static _awaitImageLoad(e){return new Promise((t,i)=>{if(e.complete&&0!==e.naturalWidth)t();else{let r,s;r=()=>{e.removeEventListener("load",r),e.removeEventListener("error",s),t()},s=()=>{e.removeEventListener("load",r),e.removeEventListener("error",s),i("Image load error")},e.addEventListener("load",r),e.addEventListener("error",s)}})}static _postWorkerMessage(e,t,i){return Promise.resolve(e).then(e=>{e instanceof Worker&&e.postMessage({type:t,data:i})})}}o.DEFAULT_CANVAS_SIZE=400,o.NO_QR_CODE_FOUND="No QR code found",o.WORKER_PATH="qr-scanner-worker.min.js";var c=i("vkgz"),h=i("eIep"),d=i("JIr8"),l=i("fXoL");let m=(()=>{class e{constructor(){}ngOnInit(){console.log(this.imageData)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Gb({type:e,selectors:[["app-image-crop"]],inputs:{imageData:"imageData"},decls:7,vars:1,consts:[[1,"image-container"],[3,"src"],[1,"crop-rect"],[1,"crop-rect-left"],[1,"crop-rect-right"],[1,"crop-rect-top"],[1,"crop-rect-bottom"]],template:function(e,t){1&e&&(l.Sb(0,"div",0),l.Nb(1,"img",1),l.Sb(2,"div",2),l.Nb(3,"div",3),l.Nb(4,"div",4),l.Nb(5,"div",5),l.Nb(6,"div",6),l.Rb(),l.Rb()),2&e&&(l.Cb(1),l.hc("src",t.imageData,l.lc))},styles:[".image-container[_ngcontent-%COMP%]{width:calc(100vw - 30px);height:calc(100vh - 30px);margin:auto}"]}),e})();function u(e,t){if(1&e&&(l.Sb(0,"div",3),l.rc(1),l.Rb()),2&e){const e=l.cc();l.Cb(1),l.sc(e.qrResult)}}function g(e,t){if(1&e&&(l.Sb(0,"div",4),l.rc(1),l.Nb(2,"app-image-crop",5),l.Rb()),2&e){const e=l.cc();l.Cb(1),l.tc(" ",e.qrError," "),l.Cb(1),l.hc("imageData",e.errImg.imageData)}}o.WORKER_PATH="/assets/service-workers/qr-scanner-worker.min.js";const v=[{path:"",component:(()=>{class e{constructor(e){this.cdr=e}static convertToImage(e){return n.a.create(t=>{const i=new FileReader;i.onloadend=e=>{t.next({imageData:e.target.result}),t.complete()},i.onerror=()=>t.error(),i.readAsDataURL(e)})}ngOnInit(){}onError(t,i){return Object(a.a)(i).pipe(Object(c.a)(e=>{this.qrError="Unable to find qr code in the image",console.warn(e)}),Object(h.a)(()=>e.convertToImage(t)),Object(c.a)(e=>this.errImg=e))}scan(e){Object(a.a)(1).pipe(Object(c.a)(()=>this.qrError=this.qrResult=""),Object(h.a)(()=>o.scanImage(e)),Object(c.a)(e=>this.qrResult=e),Object(d.a)(t=>this.onError(e,t)),Object(c.a)(()=>this.cdr.markForCheck())).subscribe()}fileChanged(e){this.scan(e.target.files[0])}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(l.h))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-qr"]],decls:4,vars:2,consts:[["class","success",4,"ngIf"],["class","error",4,"ngIf"],["type","file","capture","environment","accept","image/*",3,"change"],[1,"success"],[1,"error"],[3,"imageData"]],template:function(e,t){1&e&&(l.qc(0,u,2,1,"div",0),l.qc(1,g,3,2,"div",1),l.rc(2,"\nUpload image with QR code\n"),l.Sb(3,"input",2),l.ac("change",(function(e){return t.fileChanged(e)})),l.Rb()),2&e&&(l.hc("ngIf",t.qrResult),l.Cb(1),l.hc("ngIf",t.qrError))},directives:[r.j,m],styles:[".success[_ngcontent-%COMP%]{color:rgba(25,102,63,.582)}.error[_ngcontent-%COMP%]{color:red}"],changeDetection:0}),e})()}];let _=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[s.e.forChild(v)],s.e]}),e})(),p=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[r.c]]}),e})(),f=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[r.c,p,_]]}),e})()}}]);