(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{S5Eb:function(e,t,n){"use strict";n.r(t),n.d(t,"QrModule",(function(){return T}));var i=n("ofXK"),r=n("tyNb"),o=n("HDdC"),a=n("LRne");class s{static hasCamera(){return navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(e=>e.some(e=>"videoinput"===e.kind)).catch(()=>!1):Promise.resolve(!1)}constructor(e,t,n=this._onDecodeError.bind(this),i=s.DEFAULT_CANVAS_SIZE,r="environment"){this.$video=e,this.$canvas=document.createElement("canvas"),this._onDecode=t,this._preferredFacingMode=r,this._active=!1,this._paused=!1,this._flashOn=!1,"number"==typeof n?(i=n,console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in the future")):this._onDecodeError=n,this.$canvas.width=i,this.$canvas.height=i,this._sourceRect={x:0,y:0,width:i,height:i},this._updateSourceRect=this._updateSourceRect.bind(this),this._onPlay=this._onPlay.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),this.$video.playsInline=!0,this.$video.muted=!0,this.$video.disablePictureInPicture=!0,this.$video.addEventListener("loadedmetadata",this._updateSourceRect),this.$video.addEventListener("play",this._onPlay),document.addEventListener("visibilitychange",this._onVisibilityChange),this._qrEnginePromise=s.createQrEngine()}hasFlash(){if(!("ImageCapture"in window))return Promise.resolve(!1);const e=this.$video.srcObject?this.$video.srcObject.getVideoTracks()[0]:null;return e?new ImageCapture(e).getPhotoCapabilities().then(e=>e.fillLightMode.includes("flash")).catch(e=>(console.warn(e),!1)):Promise.reject("Camera not started or not available")}isFlashOn(){return this._flashOn}toggleFlash(){return this._setFlash(!this._flashOn)}turnFlashOff(){return this._setFlash(!1)}turnFlashOn(){return this._setFlash(!0)}destroy(){this.$video.removeEventListener("loadedmetadata",this._updateSourceRect),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),this.stop(),s._postWorkerMessage(this._qrEnginePromise,"close")}start(){if(this._active&&!this._paused)return Promise.resolve();if("https:"!==window.location.protocol&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,this._paused=!1,document.hidden)return Promise.resolve();if(clearTimeout(this._offTimeout),this._offTimeout=null,this.$video.srcObject)return this.$video.play(),Promise.resolve();let e=this._preferredFacingMode;return this._getCameraStream(e,!0).catch(()=>(e="environment"===e?"user":"environment",this._getCameraStream())).then(t=>{e=this._getFacingMode(t)||e,this.$video.srcObject=t,this.$video.play(),this._setVideoMirror(e)}).catch(e=>{throw this._active=!1,e})}stop(){this.pause(),this._active=!1}pause(){this._paused=!0,this._active&&(this.$video.pause(),this._offTimeout||(this._offTimeout=setTimeout(()=>{const e=this.$video.srcObject?this.$video.srcObject.getTracks():[];for(const t of e)t.stop();this.$video.srcObject=null,this._offTimeout=null},300)))}static scanImage(e,t=null,n=null,i=null,r=!1,o=!1){const a=n instanceof Worker;let c=Promise.all([n||s.createQrEngine(),s._loadImage(e)]).then(([e,o])=>{let c;return n=e,[i,c]=this._drawToCanvas(o,t,i,r),n instanceof Worker?(a||n.postMessage({type:"inversionMode",data:"both"}),new Promise((e,t)=>{let r,o,a;o=i=>{"qrResult"===i.data.type&&(n.removeEventListener("message",o),n.removeEventListener("error",a),clearTimeout(r),null!==i.data.data?e(i.data.data):t(s.NO_QR_CODE_FOUND))},a=e=>{n.removeEventListener("message",o),n.removeEventListener("error",a),clearTimeout(r),t("Scanner error: "+(e?e.message||e:"Unknown Error"))},n.addEventListener("message",o),n.addEventListener("error",a),r=setTimeout(()=>a("timeout"),1e4);const h=c.getImageData(0,0,i.width,i.height);n.postMessage({type:"decode",data:h},[h.data.buffer])})):new Promise((e,t)=>{const r=setTimeout(()=>t("Scanner error: timeout"),1e4);n.detect(i).then(n=>{n.length?e(n[0].rawValue):t(s.NO_QR_CODE_FOUND)}).catch(e=>t("Scanner error: "+(e.message||e))).finally(()=>clearTimeout(r))})});return t&&o&&(c=c.catch(()=>s.scanImage(e,null,n,i,r))),c=c.finally(()=>{a||s._postWorkerMessage(n,"close")}),c}setGrayscaleWeights(e,t,n,i=!0){s._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:n,useIntegerApproximation:i})}setInversionMode(e){s._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static createQrEngine(e=s.WORKER_PATH){return("BarcodeDetector"in window?BarcodeDetector.getSupportedFormats():Promise.resolve([])).then(t=>-1!==t.indexOf("qr_code")?new BarcodeDetector({formats:["qr_code"]}):new Worker(e))}_onPlay(){this._updateSourceRect(),this._scanFrame()}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_updateSourceRect(){const e=Math.min(this.$video.videoWidth,this.$video.videoHeight),t=Math.round(2/3*e);this._sourceRect.width=this._sourceRect.height=t,this._sourceRect.x=(this.$video.videoWidth-t)/2,this._sourceRect.y=(this.$video.videoHeight-t)/2}_scanFrame(){if(!this._active||this.$video.paused||this.$video.ended)return!1;requestAnimationFrame(()=>{this.$video.readyState<=1?this._scanFrame():this._qrEnginePromise.then(e=>s.scanImage(this.$video,this._sourceRect,e,this.$canvas,!0)).then(this._onDecode,e=>{this._active&&(-1!==(e.message||e).indexOf("service unavailable")&&(this._qrEnginePromise=s.createQrEngine()),this._onDecodeError(e))}).then(()=>this._scanFrame())})}_onDecodeError(e){e!==s.NO_QR_CODE_FOUND&&console.log(e)}_getCameraStream(e,t=!1){const n=[{width:{min:1024}},{width:{min:768}},{}];return e&&(t&&(e={exact:e}),n.forEach(t=>t.facingMode=e)),this._getMatchingCameraStream(n)}_getMatchingCameraStream(e){return navigator.mediaDevices&&0!==e.length?navigator.mediaDevices.getUserMedia({video:e.shift()}).catch(()=>this._getMatchingCameraStream(e)):Promise.reject("Camera not found.")}_setFlash(e){return this.hasFlash().then(t=>t?this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:e}]}):Promise.reject("No flash available")).then(()=>this._flashOn=e)}_setVideoMirror(e){this.$video.style.transform="scaleX("+("user"===e?-1:1)+")"}_getFacingMode(e){const t=e.getVideoTracks()[0];return t?/rear|back|environment/i.test(t.label)?"environment":/front|user|face/i.test(t.label)?"user":null:null}static _drawToCanvas(e,t=null,n=null,i=!1){n=n||document.createElement("canvas");const r=t&&t.x?t.x:0,o=t&&t.y?t.y:0,a=t&&t.width?t.width:e.width||e.videoWidth,s=t&&t.height?t.height:e.height||e.videoHeight;i||n.width===a&&n.height===s||(n.width=a,n.height=s);const c=n.getContext("2d",{alpha:!1});return c.imageSmoothingEnabled=!1,c.drawImage(e,r,o,a,s,0,0,n.width,n.height),[n,c]}static _loadImage(e){if(e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||window.ImageBitmap&&e instanceof window.ImageBitmap||window.OffscreenCanvas&&e instanceof window.OffscreenCanvas)return Promise.resolve(e);if(e instanceof Image)return s._awaitImageLoad(e).then(()=>e);if(e instanceof File||e instanceof Blob||e instanceof URL||"string"==typeof e){const t=new Image;return t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e,s._awaitImageLoad(t).then(()=>((e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src),t))}return Promise.reject("Unsupported image type.")}static _awaitImageLoad(e){return new Promise((t,n)=>{if(e.complete&&0!==e.naturalWidth)t();else{let i,r;i=()=>{e.removeEventListener("load",i),e.removeEventListener("error",r),t()},r=()=>{e.removeEventListener("load",i),e.removeEventListener("error",r),n("Image load error")},e.addEventListener("load",i),e.addEventListener("error",r)}})}static _postWorkerMessage(e,t,n){return Promise.resolve(e).then(e=>{e instanceof Worker&&e.postMessage({type:t,data:n})})}}s.DEFAULT_CANVAS_SIZE=400,s.NO_QR_CODE_FOUND="No QR code found",s.WORKER_PATH="qr-scanner-worker.min.js";var c=n("vkgz"),h=n("eIep"),g=n("JIr8"),l=n("fXoL"),d=n("XNiG"),u=n("7o/Q"),m=n("D0XW");n("l7GE"),n("ZUHj");const p={leading:!0,trailing:!1};class v{constructor(e,t,n,i){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=i}call(e,t){return t.subscribe(new f(e,this.duration,this.scheduler,this.leading,this.trailing))}}class f extends u.a{constructor(e,t,n,i,r){super(e),this.duration=t,this.scheduler=n,this.leading=i,this.trailing=r,this._hasTrailingValue=!1,this._trailingValue=null}_next(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(b,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))}_complete(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()}clearThrottle(){const e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)}}function b(e){const{subscriber:t}=e;t.clearThrottle()}var _=n("1G5W"),O=n("bTqV");const C=["imageContainer"],w=["cropRect"],E=["image"],P=["canvas"],M=function(e,t,n,i){return{top:e,bottom:t,left:n,right:i}};let D=(()=>{class e{constructor(){this.croppedImage=new l.o,this.topOffset="10px",this.bottomOffset="10px",this.leftOffset="10px",this.rightOffset="10px",this.onDestroyed$=new d.a,this.mouseDragOverEvent$=new d.a}ngOnInit(){this.mouseDragOverEvent$.pipe(function(e,t=m.a,n=p){return i=>i.lift(new v(e,t,n.leading,n.trailing))}(100),Object(_.a)(this.onDestroyed$)).subscribe(({event:{viewPortX:e,viewPortY:t},border:n})=>{const i=this.imgContainerElement.nativeElement.getBoundingClientRect(),r=e-i.x,o=t-i.y;switch(n){case"left":this.leftOffset=r>=0?r+"px":this.leftOffset;break;case"right":const e=i.width-r;this.rightOffset=e>=0?e+"px":this.rightOffset;break;case"top":this.topOffset=o>=0?o+"px":this.topOffset;break;case"bottom":this.bottomOffset=i.height-o+"px"}})}ngOnChanges(e){this.leftOffset=this.topOffset=this.rightOffset=this.bottomOffset="10px"}ngOnDestroy(){this.onDestroyed$.next(),this.onDestroyed$.complete()}onDragStart(e,t){this.currentlyDragging=e;const n=new Image;n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",t.dataTransfer.setDragImage(n,0,0)}onDragOver(e){this.mouseDragOverEvent$.next({event:{viewPortX:e.clientX,viewPortY:e.clientY},border:this.currentlyDragging})}onTouchDrag(e,t){t.preventDefault();const n=t.touches[0];this.mouseDragOverEvent$.next({event:{viewPortX:n.clientX,viewPortY:n.clientY},border:e})}cropImage(){const e=this.imageElement.nativeElement,t=this.cropRectElement.nativeElement.getBoundingClientRect(),n=this.imgContainerElement.nativeElement.getBoundingClientRect(),i=e.naturalWidth/n.width,r=e.naturalHeight/n.height,o=(t.left-n.left)*i,a=(t.top-n.top)*r,s=t.width*i,c=t.height*r,h=this.canvasElement.nativeElement;h.width=s,h.height=c,h.getContext("2d").drawImage(e,o,a,s,c,0,0,s,c),this.croppedImage.next(h.toDataURL())}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Gb({type:e,selectors:[["app-image-crop"]],viewQuery:function(e,t){var n;1&e&&(l.xc(C,!0),l.xc(w,!0),l.xc(E,!0),l.xc(P,!0)),2&e&&(l.lc(n=l.bc())&&(t.imgContainerElement=n.first),l.lc(n=l.bc())&&(t.cropRectElement=n.first),l.lc(n=l.bc())&&(t.imageElement=n.first),l.lc(n=l.bc())&&(t.canvasElement=n.first))},inputs:{imageData:"imageData"},outputs:{croppedImage:"croppedImage"},features:[l.Ab],decls:19,vars:7,consts:[[1,"crop-container"],[1,"image-container",3,"dragover"],["imageContainer",""],[3,"src"],["image",""],[1,"crop-rect",3,"ngStyle"],["cropRect",""],["draggable","true",1,"crop-rect-right",3,"dragstart","touchmove"],[1,"circle"],["draggable","true",1,"crop-rect-left",3,"dragstart","touchmove"],["draggable","true",1,"crop-rect-bottom",3,"dragstart","touchmove"],["draggable","true",1,"crop-rect-top",3,"dragstart","touchmove"],["mat-raised-button","","mat-primary","",3,"click"],[2,"display","none"],["canvas",""]],template:function(e,t){1&e&&(l.Sb(0,"div",0),l.Sb(1,"div",1,2),l.ac("dragover",(function(e){return t.onDragOver(e)})),l.Nb(3,"img",3,4),l.Sb(5,"div",5,6),l.Sb(7,"div",7),l.ac("dragstart",(function(e){return t.onDragStart("right",e)}))("touchmove",(function(e){return t.onTouchDrag("right",e)})),l.Nb(8,"div",8),l.Rb(),l.Sb(9,"div",9),l.ac("dragstart",(function(e){return t.onDragStart("left",e)}))("touchmove",(function(e){return t.onTouchDrag("left",e)})),l.Nb(10,"div",8),l.Rb(),l.Sb(11,"div",10),l.ac("dragstart",(function(e){return t.onDragStart("bottom",e)}))("touchmove",(function(e){return t.onTouchDrag("bottom",e)})),l.Nb(12,"div",8),l.Rb(),l.Sb(13,"div",11),l.ac("dragstart",(function(e){return t.onDragStart("top",e)}))("touchmove",(function(e){return t.onTouchDrag("top",e)})),l.Nb(14,"div",8),l.Rb(),l.Rb(),l.Rb(),l.Rb(),l.Sb(15,"button",12),l.ac("click",(function(){return t.cropImage()})),l.uc(16,"CROP 2"),l.Rb(),l.Nb(17,"canvas",13,14)),2&e&&(l.Cb(3),l.jc("src",t.imageData,l.oc),l.Cb(2),l.jc("ngStyle",l.kc(2,M,t.topOffset,t.bottomOffset,t.leftOffset,t.rightOffset)))},directives:[i.k,O.a],styles:[".crop-container[_ngcontent-%COMP%]{text-align:center}.image-container[_ngcontent-%COMP%]{margin:auto;display:inline-block;position:relative}.image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;max-height:calc(100vh - 30px);-o-object-fit:scale-down;object-fit:scale-down}.image-container[_ngcontent-%COMP%]   .crop-rect[_ngcontent-%COMP%]{position:absolute}.image-container[_ngcontent-%COMP%]   .crop-rect-bottom[_ngcontent-%COMP%], .image-container[_ngcontent-%COMP%]   .crop-rect-left[_ngcontent-%COMP%], .image-container[_ngcontent-%COMP%]   .crop-rect-right[_ngcontent-%COMP%], .image-container[_ngcontent-%COMP%]   .crop-rect-top[_ngcontent-%COMP%]{position:absolute;background-color:red}.image-container[_ngcontent-%COMP%]   .crop-rect-left[_ngcontent-%COMP%]{left:0;height:100%;width:2px;cursor:ew-resize}.image-container[_ngcontent-%COMP%]   .crop-rect-right[_ngcontent-%COMP%]{right:0;height:100%;width:2px;cursor:ew-resize}.image-container[_ngcontent-%COMP%]   .crop-rect-top[_ngcontent-%COMP%]{top:0;width:100%;height:2px;cursor:ns-resize}.image-container[_ngcontent-%COMP%]   .crop-rect-bottom[_ngcontent-%COMP%]{bottom:0;width:100%;height:2px;cursor:ns-resize}.image-container[_ngcontent-%COMP%]   .crop-rect[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]{border-radius:10px;background-color:red;width:20px;height:20px;position:absolute}.image-container[_ngcontent-%COMP%]   .crop-rect-left[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%], .image-container[_ngcontent-%COMP%]   .crop-rect-right[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]{top:calc(50% - 10px);left:-10px}.image-container[_ngcontent-%COMP%]   .crop-rect-bottom[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%], .image-container[_ngcontent-%COMP%]   .crop-rect-top[_ngcontent-%COMP%]   .circle[_ngcontent-%COMP%]{left:calc(50% - 10px);top:-10px}"],changeDetection:0}),e})();function y(e,t){if(1&e&&(l.Sb(0,"div",4),l.uc(1),l.Rb()),2&e){const e=l.ec();l.Cb(1),l.vc(e.qrResult)}}function R(e,t){if(1&e&&(l.Sb(0,"div",5),l.uc(1),l.Rb()),2&e){const e=l.ec();l.Cb(1),l.wc(" ",e.qrError,". If you think the image contains qr code please crop the image to just contain the qr Code. Use the red box below over the image to select the qr portion and click on the crop button at the bottom of the image.\n")}}function I(e,t){1&e&&(l.Sb(0,"div"),l.uc(1," Please wait while we scan for a qr code in the image...\n"),l.Rb())}function S(e,t){if(1&e){const e=l.Tb();l.Sb(0,"div",5),l.Sb(1,"app-image-crop",6),l.ac("croppedImage",(function(t){return l.nc(e),l.ec().onImageCrop(t)})),l.Rb(),l.Rb()}if(2&e){const e=l.ec();l.Cb(1),l.jc("imageData",e.errImg.imageData)}}s.WORKER_PATH="/assets/service-workers/qr-scanner-worker.min.js";const j=[{path:"",component:(()=>{class e{constructor(e){this.cdr=e,this.isScanning=!1}static convertFileToImageBase64(e){return o.a.create(t=>{const n=new FileReader;n.onloadend=e=>{t.next({imageData:e.target.result}),t.complete()},n.onerror=()=>t.error(),n.readAsDataURL(e)})}ngOnInit(){}onError(t,n){return Object(a.a)(n).pipe(Object(c.a)(e=>{this.qrError="Unable to find qr code in the image",console.warn(e)}),Object(h.a)(()=>e.convertFileToImageBase64(t)),Object(c.a)(e=>this.errImg=e))}onErrorB64(e,t){return Object(a.a)(t).pipe(Object(c.a)(e=>{this.qrError="Unable to find qr code in the image",console.warn(e)}),Object(c.a)(()=>this.errImg={imageData:e}))}scanFile(e){Object(a.a)(1).pipe(Object(c.a)(()=>{this.qrError=this.qrResult="",this.isScanning=!0,this.cdr.markForCheck()}),Object(h.a)(()=>s.scanImage(e)),Object(c.a)(e=>this.qrResult=e),Object(g.a)(t=>this.onError(e,t)),Object(c.a)(()=>{this.isScanning=!1,this.cdr.markForCheck()})).subscribe()}scanFileB64(e){Object(a.a)(1).pipe(Object(c.a)(()=>{this.qrError=this.qrResult="",this.isScanning=!0,this.cdr.markForCheck()}),Object(h.a)(()=>{const t=document.createElement("img");return t.src=e,s.scanImage(t)}),Object(c.a)(e=>this.qrResult=e),Object(g.a)(t=>this.onErrorB64(e,t)),Object(c.a)(()=>{this.isScanning=!1,this.cdr.markForCheck()})).subscribe()}fileChanged(e){this.scanFile(e.target.files[0])}onImageCrop(e){this.scanFileB64(e)}}return e.\u0275fac=function(t){return new(t||e)(l.Mb(l.h))},e.\u0275cmp=l.Gb({type:e,selectors:[["app-qr"]],decls:6,vars:4,consts:[["class","success",4,"ngIf"],["class","error",4,"ngIf"],[4,"ngIf"],["type","file","accept","image/*",3,"change"],[1,"success"],[1,"error"],[3,"imageData","croppedImage"]],template:function(e,t){1&e&&(l.tc(0,y,2,1,"div",0),l.tc(1,R,2,1,"div",1),l.tc(2,I,2,0,"div",2),l.tc(3,S,2,1,"div",1),l.uc(4,"\nUpload image with QR code\n"),l.Sb(5,"input",3),l.ac("change",(function(e){return t.fileChanged(e)})),l.Rb()),2&e&&(l.jc("ngIf",t.qrResult),l.Cb(1),l.jc("ngIf",t.qrError),l.Cb(1),l.jc("ngIf",t.isScanning),l.Cb(1),l.jc("ngIf",t.errImg&&!t.isScanning))},directives:[i.j,D],styles:[".success[_ngcontent-%COMP%]{color:rgba(25,102,63,.582)}.error[_ngcontent-%COMP%]{color:red}"],changeDetection:0}),e})()}];let x=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[r.g.forChild(j)],r.g]}),e})(),k=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[i.c,O.b]]}),e})(),T=(()=>{class e{}return e.\u0275mod=l.Kb({type:e}),e.\u0275inj=l.Jb({factory:function(t){return new(t||e)},imports:[[i.c,k,x]]}),e})()}}]);